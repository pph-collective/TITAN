
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the TITAN model">
      
      
      
      
        <link rel="canonical" href="http://marshall-lab.github.io/TITAN/api/population/">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>Population - TITAN</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#population" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="http://marshall-lab.github.io/TITAN" title="TITAN" class="md-header-nav__button md-logo" aria-label="TITAN">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            TITAN
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Population
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="http://marshall-lab.github.io/TITAN" title="TITAN" class="md-nav__button md-logo" aria-label="TITAN">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    TITAN
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        Getting Started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../run_local/" class="md-nav__link">
        Running locally
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../run_oscar/" class="md-nav__link">
        Running on Oscar
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        API Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        Agent
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../agent_set/" class="md-nav__link">
        AgentSet
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3" >
      
      <label class="md-nav__link" for="nav-3-3">
        Agent Exposures
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Agent Exposures" data-md-level="2">
        <label class="md-nav__title" for="nav-3-3">
          <span class="md-nav__icon md-icon"></span>
          Agent Exposures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../exposures/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../exposures/hiv/" class="md-nav__link">
        HIV
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../exposures/knowledge/" class="md-nav__link">
        Knowledge
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" >
      
      <label class="md-nav__link" for="nav-3-4">
        Agent Features
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Agent Features" data-md-level="2">
        <label class="md-nav__title" for="nav-3-4">
          <span class="md-nav__icon md-icon"></span>
          Agent Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/haart/" class="md-nav__link">
        HAART
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/high_risk/" class="md-nav__link">
        High Risk
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/incar/" class="md-nav__link">
        Incarceration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/external_exposure/" class="md-nav__link">
        External Exposure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/partner_tracing/" class="md-nav__link">
        Partner Tracing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/prep/" class="md-nav__link">
        PrEP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/random_trial/" class="md-nav__link">
        Random Trial
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/syringe_services/" class="md-nav__link">
        Syringe Services
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../features/vaccine/" class="md-nav__link">
        Vaccine
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5" >
      
      <label class="md-nav__link" for="nav-3-5">
        Agent Interactions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Agent Interactions" data-md-level="2">
        <label class="md-nav__title" for="nav-3-5">
          <span class="md-nav__icon md-icon"></span>
          Agent Interactions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../interactions/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../interactions/injection/" class="md-nav__link">
        Injection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../interactions/pca/" class="md-nav__link">
        Peer Change Agent
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../interactions/sex/" class="md-nav__link">
        Sex
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../location/" class="md-nav__link">
        Location
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../model/" class="md-nav__link">
        Model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../partnering/" class="md-nav__link">
        Partnering
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Population
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Population
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#population" class="md-nav__link">
    Population
  </a>
  
    <nav class="md-nav" aria-label="Population">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.add_agent" class="md-nav__link">
    add_agent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.add_relationship" class="md-nav__link">
    add_relationship()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.connected_components" class="md-nav__link">
    connected_components()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.create_agent" class="md-nav__link">
    create_agent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.get_age" class="md-nav__link">
    get_age()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.remove_agent" class="md-nav__link">
    remove_agent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.remove_relationship" class="md-nav__link">
    remove_relationship()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.trim_graph" class="md-nav__link">
    trim_graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_agent_partners" class="md-nav__link">
    update_agent_partners()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_partner_assignments" class="md-nav__link">
    update_partner_assignments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_partner_targets" class="md-nav__link">
    update_partner_targets()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_partnerability" class="md-nav__link">
    update_partnerability()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#population-reading-writing" class="md-nav__link">
    Population Reading &amp; Writing
  </a>
  
    <nav class="md-nav" aria-label="Population Reading &amp; Writing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-the-population" class="md-nav__link">
    Saving the Population
  </a>
  
    <nav class="md-nav" aria-label="Saving the Population">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#titan.population_io.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-inusing-a-saved-population" class="md-nav__link">
    Reading in/using a Saved Population
  </a>
  
    <nav class="md-nav" aria-label="Reading in/using a Saved Population">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#titan.population_io.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../relationship/" class="md-nav__link">
        Relationship
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reporting/" class="md-nav__link">
        Reporting
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        Utility Functions
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#population" class="md-nav__link">
    Population
  </a>
  
    <nav class="md-nav" aria-label="Population">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.add_agent" class="md-nav__link">
    add_agent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.add_relationship" class="md-nav__link">
    add_relationship()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.connected_components" class="md-nav__link">
    connected_components()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.create_agent" class="md-nav__link">
    create_agent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.get_age" class="md-nav__link">
    get_age()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.remove_agent" class="md-nav__link">
    remove_agent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.remove_relationship" class="md-nav__link">
    remove_relationship()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.trim_graph" class="md-nav__link">
    trim_graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_agent_partners" class="md-nav__link">
    update_agent_partners()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_partner_assignments" class="md-nav__link">
    update_partner_assignments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_partner_targets" class="md-nav__link">
    update_partner_targets()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titan.population.Population.update_partnerability" class="md-nav__link">
    update_partnerability()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#population-reading-writing" class="md-nav__link">
    Population Reading &amp; Writing
  </a>
  
    <nav class="md-nav" aria-label="Population Reading &amp; Writing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-the-population" class="md-nav__link">
    Saving the Population
  </a>
  
    <nav class="md-nav" aria-label="Saving the Population">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#titan.population_io.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-inusing-a-saved-population" class="md-nav__link">
    Reading in/using a Saved Population
  </a>
  
    <nav class="md-nav" aria-label="Reading in/using a Saved Population">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#titan.population_io.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Population</h1>
                
                <h2 id="population">Population</h2>
<p>The <code>Population</code> class is used to represent the population of agents the model is running on.  On construction, it stochastically creates the population described in the <code>params</code>.  At its core, it is a graph with nodes (<code>all_agents</code>) and edges (<code>relationships</code>), it can be formally backed by a NetworkX graph by enabling the graph in the prams file.  This allows for some graph-specific logic to be applied throughout the running of the model (e.g. trimming components, writing network statistics).</p>
<div class="doc doc-object doc-class">
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.__init__">

<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Initialize Population object.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>params</code></td>
<td><code>parse_params.ObjMap</code></td>
<td>
<p>Model parameters</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>id</code></td>
<td><code>Optional[str]</code></td>
<td>
<p>8 character identifier for a model</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="s2">"parse_params.ObjMap"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Initialize Population object.</span>

<span class="sd">    args:</span>
<span class="sd">        params : Model parameters</span>
<span class="sd">        id: 8 character identifier for a model</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">nanoid</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pop_seed</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_check_rand_int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">ppl</span><span class="p">)</span>

    <span class="c1"># Init RNG for population creation to pop_seed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_seed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_seed</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">enable</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

    <span class="c1"># set up the in-scope exposures</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exposures</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">exposure</span>
        <span class="k">for</span> <span class="n">exposure</span> <span class="ow">in</span> <span class="n">exposures</span><span class="o">.</span><span class="n">BaseExposure</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">exposures</span><span class="p">[</span><span class="n">exposure</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="c1"># initialize the class level items</span>
    <span class="k">for</span> <span class="n">exposure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposures</span><span class="p">:</span>
        <span class="n">exposure</span><span class="o">.</span><span class="n">init_class</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># set up the in-scope features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">feature</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">BaseFeature</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="c1"># initialize the class level items</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
        <span class="n">feature</span><span class="o">.</span><span class="n">init_class</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># set up the population's locations and edges</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geography</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">Geography</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># All agent set list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_agents</span> <span class="o">=</span> <span class="n">ag</span><span class="o">.</span><span class="n">AgentSet</span><span class="p">(</span><span class="s2">"AllAgents"</span><span class="p">)</span>

    <span class="c1"># pwid agents (performance for partnering)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pwid_agents</span> <span class="o">=</span> <span class="n">ag</span><span class="o">.</span><span class="n">AgentSet</span><span class="p">(</span><span class="s2">"PWID"</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all_agents</span><span class="p">)</span>

    <span class="c1"># agents who can take on a partner</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="s2">"ag.Agent"</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">bond_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">[</span><span class="n">bond_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># who can sleep with whom</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sex_partners</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="s2">"ag.Agent"</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">sex_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">sex_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sex_partners</span><span class="p">[</span><span class="n">sex_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="s2">"ag.Relationship"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># find average partnership durations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mean_rel_duration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">partnering</span><span class="o">.</span><span class="n">get_mean_rel_duration</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Creating agents"</span><span class="p">)</span>
    <span class="c1"># for each location in the population, create agents per that location's demographics</span>
    <span class="n">init_time</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">burn_steps</span>
    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geography</span><span class="o">.</span><span class="n">locations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">race</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">races</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="nb">round</span><span class="p">(</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_pop</span>
                    <span class="o">*</span> <span class="n">loc</span><span class="o">.</span><span class="n">ppl</span>
                    <span class="o">*</span> <span class="n">loc</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">race</span><span class="p">]</span><span class="o">.</span><span class="n">ppl</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_agent</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">race</span><span class="p">,</span> <span class="n">init_time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="c1"># initialize relationships</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Creating Relationships"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_partner_assignments</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trim_graph</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.add_agent">

<code class="highlight language-python"><span class="n">add_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Adds an agent to the population</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>ag.Agent</code></td>
<td>
<p>The agent to be added</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">"ag.Agent"</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Adds an agent to the population</span>

<span class="sd">    args:</span>
<span class="sd">        agent : The agent to be added</span>
<span class="sd">    """</span>

    <span class="c1"># Add to all agent set</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_agents</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">drug_type</span> <span class="o">==</span> <span class="s2">"Inj"</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwid_agents</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="c1"># who can sleep with this agent</span>
    <span class="k">for</span> <span class="n">sex_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">sex_types</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">]</span><span class="o">.</span><span class="n">sleeps_with</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sex_partners</span><span class="p">[</span><span class="n">sex_type</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.add_relationship">

<code class="highlight language-python"><span class="n">add_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Add a new relationship to the population.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rel</code></td>
<td><code>ag.Relationship</code></td>
<td>
<p>The Relationship to be added</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">:</span> <span class="s2">"ag.Relationship"</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Add a new relationship to the population.</span>

<span class="sd">    args:</span>
<span class="sd">        rel : The Relationship to be added</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">rel</span><span class="o">.</span><span class="n">bond_type</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.connected_components">

<code class="highlight language-python"><span class="n">connected_components</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Get connected components in graph (if enabled)</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>List</code></td>
<td>
<p>list of connected components</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">connected_components</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Get connected components in graph (if enabled)</span>

<span class="sd">    returns:</span>
<span class="sd">        list of connected components</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"Can't get connected_components, population doesn't have graph enabled."</span>
        <span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.create_agent">

<code class="highlight language-python"><span class="n">create_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">race</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">sex_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drug_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Create a new agent with randomly assigned attributes according to population
demographics [params.demographics]</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>loc</code></td>
<td><code>location.Location</code></td>
<td>
<p>location the agent will live in</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>race</code></td>
<td><code>str</code></td>
<td>
<p>race of the new agent</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>time</code></td>
<td><code>int</code></td>
<td>
<p>current time step of the model</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>sex_type</code></td>
<td><code>Optional[str]</code></td>
<td>
<p>sex_type of the new agent</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ag.Agent</code></td>
<td>
<p>a new agent</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_agent</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">loc</span><span class="p">:</span> <span class="s2">"location.Location"</span><span class="p">,</span>
    <span class="n">race</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">sex_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">drug_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"ag.Agent"</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Create a new agent with randomly assigned attributes according to population</span>
<span class="sd">    demographics [params.demographics]</span>

<span class="sd">    args:</span>
<span class="sd">        loc: location the agent will live in</span>
<span class="sd">        race : race of the new agent</span>
<span class="sd">        time: current time step of the model</span>
<span class="sd">        sex_type : sex_type of the new agent</span>

<span class="sd">    returns:</span>
<span class="sd">         a new agent</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">sex_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sex_type</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">.</span><span class="n">pop_weights</span><span class="p">[</span><span class="n">race</span><span class="p">][</span><span class="s2">"values"</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">loc</span><span class="o">.</span><span class="n">pop_weights</span><span class="p">[</span><span class="n">race</span><span class="p">][</span><span class="s2">"weights"</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># no choice available</span>
        <span class="k">if</span> <span class="n">sex_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Agent must have sex type"</span><span class="p">)</span>

    <span class="c1"># Determine drugtype</span>
    <span class="k">if</span> <span class="n">drug_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">drug_type</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">.</span><span class="n">drug_weights</span><span class="p">[</span><span class="n">race</span><span class="p">][</span><span class="n">sex_type</span><span class="p">][</span><span class="s2">"values"</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">loc</span><span class="o">.</span><span class="n">drug_weights</span><span class="p">[</span><span class="n">race</span><span class="p">][</span><span class="n">sex_type</span><span class="p">][</span><span class="s2">"weights"</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># no choice available</span>
        <span class="k">if</span> <span class="n">drug_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Agent must have drug type"</span><span class="p">)</span>

    <span class="n">age</span><span class="p">,</span> <span class="n">age_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_age</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">race</span><span class="p">)</span>

    <span class="n">agent</span> <span class="o">=</span> <span class="n">ag</span><span class="o">.</span><span class="n">Agent</span><span class="p">(</span><span class="n">sex_type</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">race</span><span class="p">,</span> <span class="n">drug_type</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">age_bin</span> <span class="o">=</span> <span class="n">age_bin</span>

    <span class="n">sex_role</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">.</span><span class="n">role_weights</span><span class="p">[</span><span class="n">race</span><span class="p">][</span><span class="n">sex_type</span><span class="p">][</span><span class="s2">"values"</span><span class="p">],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">loc</span><span class="o">.</span><span class="n">role_weights</span><span class="p">[</span><span class="n">race</span><span class="p">][</span><span class="n">sex_type</span><span class="p">][</span><span class="s2">"weights"</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">sex_role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Agent must have sex role"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">sex_role</span> <span class="o">=</span> <span class="n">sex_role</span>

    <span class="n">agent_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">race</span><span class="p">]</span>
        <span class="o">.</span><span class="n">sex_type</span><span class="p">[</span><span class="n">sex_type</span><span class="p">]</span>
        <span class="o">.</span><span class="n">drug_type</span><span class="p">[</span><span class="n">drug_type</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">exposure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposures</span><span class="p">:</span>
        <span class="n">agent_feature</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">exposure</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">agent_feature</span><span class="o">.</span><span class="n">init_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">bond</span><span class="p">,</span> <span class="n">bond_def</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">dist_info</span> <span class="o">=</span> <span class="n">agent_params</span><span class="o">.</span><span class="n">num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">safe_dist</span><span class="p">(</span><span class="n">dist_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_divide</span><span class="p">(</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">sex</span><span class="o">.</span><span class="n">partner</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mean_rel_duration</span><span class="p">[</span><span class="n">bond</span><span class="p">][</span><span class="n">race</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># so not zero if added mid-year</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">"injection"</span> <span class="ow">in</span> <span class="n">bond_def</span><span class="o">.</span><span class="n">acts_allowed</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">drug_type</span> <span class="o">==</span> <span class="s2">"Inj"</span> <span class="ow">or</span> <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
        <span class="n">agent_feature</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">agent_feature</span><span class="o">.</span><span class="n">init_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">agent</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.get_age">

<code class="highlight language-python"><span class="n">get_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">race</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Given the population characteristics, get a random age to assign to an agent given the race of that agent</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>race</code></td>
<td><code>str</code></td>
<td>
<p>race of the agent whose age is being generated</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Tuple[int, int]</code></td>
<td>
<p>age and the bin the age came from</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">:</span> <span class="s2">"location.Location"</span><span class="p">,</span> <span class="n">race</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">"""</span>
<span class="sd">    Given the population characteristics, get a random age to assign to an agent given the race of that agent</span>

<span class="sd">    args:</span>
<span class="sd">        race : race of the agent whose age is being generated</span>

<span class="sd">    returns:</span>
<span class="sd">        age and the bin the age came from</span>
<span class="sd">    """</span>
    <span class="n">rand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

    <span class="n">bins</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">race</span><span class="p">]</span><span class="o">.</span><span class="n">age</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rand</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">min_age</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
    <span class="n">max_age</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>

    <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_age</span><span class="p">,</span> <span class="n">max_age</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">age</span><span class="p">,</span> <span class="n">i</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.remove_agent">

<code class="highlight language-python"><span class="n">remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Remove an agent from the population.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>ag.Agent</code></td>
<td>
<p>Agent to remove</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">"ag.Agent"</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Remove an agent from the population.</span>

<span class="sd">    args:</span>
<span class="sd">        agent : Agent to remove</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_agents</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">partner_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sex_partners</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sex_partners</span><span class="p">[</span><span class="n">partner_type</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sex_partners</span><span class="p">[</span><span class="n">partner_type</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">exposure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposures</span><span class="p">:</span>
        <span class="n">agent_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">exposure</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">agent_attr</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="n">exposure</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
        <span class="n">agent_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">agent_attr</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="n">feature</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">:</span>
            <span class="n">bond</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.remove_relationship">

<code class="highlight language-python"><span class="n">remove_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Remove a relationship from the population.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rel</code></td>
<td><code>ag.Relationship</code></td>
<td>
<p>Relationship to remove</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">:</span> <span class="s2">"ag.Relationship"</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Remove a relationship from the population.</span>

<span class="sd">    args:</span>
<span class="sd">        rel : Relationship to remove</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>

    <span class="c1"># without this relationship, are agents partnerable again?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_partnerability</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_partnerability</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.trim_graph">

<code class="highlight language-python"><span class="n">trim_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Initialize network with graph-based algorithm for relationship
    adding/pruning</p>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">trim_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Initialize network with graph-based algorithm for relationship</span>
<span class="sd">        adding/pruning</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"comp_size"</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">trim_component</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">max_size</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                    <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">trim</span><span class="o">.</span><span class="n">prob</span>
                <span class="p">):</span>
                    <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">copy</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">relationships</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">relationships</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">break</span>  <span class="c1"># Make sure that agents stay part of the</span>
                            <span class="c1"># network by keeping one bond</span>
                        <span class="n">rel</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_relationship</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>
                        <span class="n">component</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="p">)</span>

            <span class="c1"># recurse on new sub-components</span>
            <span class="n">sub_comps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">component</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">sub_comp</span> <span class="ow">in</span> <span class="n">sub_comps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sub_comp</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_size</span><span class="p">:</span>
                    <span class="n">trim_component</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>

        <span class="n">components</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
                <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">component_size</span><span class="o">.</span><span class="n">max</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"TOO BIG"</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">())</span>
                <span class="n">trim_component</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">component_size</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Total agents in graph: "</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">())</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.update_agent_partners">

<code class="highlight language-python"><span class="n">update_agent_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">,</span> <span class="n">components</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Finds and bonds new partner. Creates relationship object for partnership,
    calcs partnership duration, adds it to the population, and adds to networkX graph if self.enable_graph
    is set True.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>ag.Agent</code></td>
<td>
<p>Agent that is seeking a new partner</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>bond_type</code></td>
<td><code>str</code></td>
<td>
<p>What type of bond the agent is seeking to make</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if no match was found for agent (used for retries)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_agent_partners</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="s2">"ag.Agent"</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">components</span><span class="p">:</span> <span class="n">List</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Finds and bonds new partner. Creates relationship object for partnership,</span>
<span class="sd">        calcs partnership duration, adds it to the population, and adds to networkX graph if self.enable_graph</span>
<span class="sd">        is set True.</span>

<span class="sd">    args:</span>
<span class="sd">        agent: Agent that is seeking a new partner</span>
<span class="sd">        bond_type: What type of bond the agent is seeking to make</span>

<span class="sd">    returns:</span>
<span class="sd">        True if no match was found for agent (used for retries)</span>
<span class="sd">    """</span>
    <span class="n">partnerable_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">[</span><span class="n">bond_type</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">same_component</span><span class="o">.</span><span class="n">prob</span>
        <span class="ow">and</span> <span class="n">agent</span><span class="o">.</span><span class="n">has_partners</span><span class="p">()</span>
    <span class="p">):</span>
        <span class="c1"># find agent's component</span>
        <span class="n">agent_component</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="s2">"ag.Agent"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
                <span class="n">agent_component</span> <span class="o">=</span> <span class="n">comp</span>
                <span class="k">break</span>

        <span class="n">partnerable_agents</span> <span class="o">=</span> <span class="n">partnerable_agents</span> <span class="o">&amp;</span> <span class="n">agent_component</span>

    <span class="n">partner</span> <span class="o">=</span> <span class="n">partnering</span><span class="o">.</span><span class="n">select_partner</span><span class="p">(</span>
        <span class="n">agent</span><span class="p">,</span>
        <span class="n">partnerable_agents</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sex_partners</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwid_agents</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="p">,</span>
        <span class="n">bond_type</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">no_match</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">partner</span><span class="p">:</span>
        <span class="n">race</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">([</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">race</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_random</span><span class="p">)</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">partnering</span><span class="o">.</span><span class="n">get_partnership_duration</span><span class="p">(</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">,</span> <span class="n">race</span>
        <span class="p">)</span>
        <span class="n">relationship</span> <span class="o">=</span> <span class="n">ag</span><span class="o">.</span><span class="n">Relationship</span><span class="p">(</span>
            <span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">bond_type</span><span class="o">=</span><span class="n">bond_type</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span><span class="n">relationship</span><span class="p">)</span>
        <span class="c1"># can partner still partner?</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">partner</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond_type</span><span class="p">])</span> <span class="o">&gt;</span> <span class="p">(</span>
            <span class="n">partner</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond_type</span><span class="p">]</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">buffer</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">[</span><span class="n">bond_type</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">partner</span><span class="p">)</span>
        <span class="n">no_match</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">no_match</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.update_partner_assignments">

<code class="highlight language-python"><span class="n">update_partner_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Determines which agents will seek new partners from All_agentSet.
    Calls update_agent_partners for any agents that desire partners.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>t</code></td>
<td><code>int</code></td>
<td>
<p>current time step of the model</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_partner_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Determines which agents will seek new partners from All_agentSet.</span>
<span class="sd">        Calls update_agent_partners for any agents that desire partners.</span>

<span class="sd">    args:</span>
<span class="sd">        t: current time step of the model</span>
<span class="sd">    """</span>
    <span class="c1"># update agent targets annually</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">steps_per_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_partner_targets</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
        <span class="n">network_components</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_components</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">network_components</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Now create partnerships until available partnerships are out</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="p">:</span>
        <span class="n">eligible_agents</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">a</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_agents</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">eligible_agents</span><span class="p">}</span>

        <span class="k">while</span> <span class="n">eligible_agents</span><span class="p">:</span>
            <span class="n">agent</span> <span class="o">=</span> <span class="n">eligible_agents</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]:</span>

                <span class="c1"># no match</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_agent_partners</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">bond</span><span class="p">,</span> <span class="n">network_components</span><span class="p">):</span>
                    <span class="n">attempts</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># add agent back to eligible pool</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">attempts</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
                    <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">break_point</span>
                <span class="p">):</span>
                    <span class="n">eligible_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.update_partner_targets">

<code class="highlight language-python"><span class="n">update_partner_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Update the target number of partners for each agent and bond type</p>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_partner_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Update the target number of partners for each agent and bond type</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_agents</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span>
                <span class="n">a</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_partnerability</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.population.Population.update_partnerability">

<code class="highlight language-python"><span class="n">update_partnerability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Update whether each agent in the population is currently able to form new relationships for each bond type</p>
<details class="quote">
          <summary>Source code in <code>titan/population.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_partnerability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Update whether each agent in the population is currently able to form new relationships for each bond type</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">[</span><span class="n">bond</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">])</span> <span class="o">&gt;</span> <span class="p">(</span>
                <span class="n">a</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">buffer</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span>
            <span class="n">a</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">buffer</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partnerable_agents</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<h2 id="population-reading-writing">Population Reading &amp; Writing</h2>
<div class="admonition info">
<p class="admonition-title">Released in v1.1.0</p>
</div>
<p>Populations can be saved to file so that they can be analysed in detail or re-used in a future run.  <code>run_titan.py</code> allows this using the <code>--savepop [path]</code> option to save the population to the path, and the <code>--poppath [path]</code> option loads the population at the path.  The population is saved after creation, but before the model has run.</p>
<h3 id="saving-the-population">Saving the Population</h3>
<p>The population is represented as a series of csv files that save the attributes for the core entities (agents, relationships at this time).  The population can be saved with only <code>core</code> attributes (e.g. race, sex_type, hiv) or with <code>intervention</code> attributes (e.g. prep, vaccinated) as well.  <code>intervention</code> attributes are less likely to work as intended across versions of the model.</p>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="titan.population_io.write">

<code class="highlight language-python"><span class="n">titan</span><span class="o">.</span><span class="n">population_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


      </h4>
<div class="doc doc-contents first">
<p>Write a non-empty Population to file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pop</code></td>
<td><code>Population</code></td>
<td>
<p>a non-empty agent population</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dir</code></td>
<td><code>str</code></td>
<td>
<p>path to directory where files should be written</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>compress</code></td>
<td><code>bool</code></td>
<td>
<p>whether to compress and archive the csv</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td>
<p>path, or archive name if compress is true</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population_io.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">pop</span><span class="p">:</span> <span class="n">Population</span><span class="p">,</span> <span class="nb">dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">compress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Write a non-empty Population to file.</span>

<span class="sd">    args:</span>
<span class="sd">        pop: a non-empty agent population</span>
<span class="sd">        dir: path to directory where files should be written</span>
<span class="sd">        compress: whether to compress and archive the csv</span>

<span class="sd">    returns:</span>
<span class="sd">        path, or archive name if compress is true</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">relationships</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Can't write empty population"</span>

    <span class="c1"># open agent file</span>
    <span class="n">agent_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">pop</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_agents.csv"</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">))</span>
    <span class="c1"># get all attributes</span>
    <span class="n">agent_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent_exclude_attrs</span><span class="p">]</span>

    <span class="n">write_class_file</span><span class="p">(</span><span class="n">agent_file</span><span class="p">,</span> <span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">,</span> <span class="n">agent_attrs</span><span class="p">)</span>

    <span class="n">extra_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># write agent extras (features, exposures) to their own files</span>
    <span class="k">def</span> <span class="nf">write_extra_class</span><span class="p">(</span><span class="n">extra_attrs</span><span class="p">,</span> <span class="n">extra_type</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">extra_attrs</span><span class="p">:</span>
            <span class="n">extra_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">extra</span><span class="p">)</span>
            <span class="n">extra_attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">extra_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">pop</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">extra_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">extra</span><span class="si">}</span><span class="s2">.csv"</span><span class="p">)</span>
            <span class="n">extra_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_file</span><span class="p">)</span>
            <span class="n">write_extra_class_file</span><span class="p">(</span><span class="n">extra_file</span><span class="p">,</span> <span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">,</span> <span class="n">extra</span><span class="p">,</span> <span class="n">extra_attrs</span><span class="p">)</span>

    <span class="n">write_extra_class</span><span class="p">(</span><span class="n">agent_feature_attrs</span><span class="p">,</span> <span class="s2">"feat"</span><span class="p">)</span>
    <span class="n">write_extra_class</span><span class="p">(</span><span class="n">agent_exposure_attrs</span><span class="p">,</span> <span class="s2">"exposure"</span><span class="p">)</span>

    <span class="c1"># open relationship file</span>
    <span class="n">rel_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">pop</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_relationships.csv"</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">relationships</span><span class="p">))</span>
    <span class="n">rel_attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">write_class_file</span><span class="p">(</span><span class="n">rel_file</span><span class="p">,</span> <span class="n">pop</span><span class="o">.</span><span class="n">relationships</span><span class="p">,</span> <span class="n">rel_attrs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
        <span class="n">archive_name</span> <span class="o">=</span> <span class="n">make_archive</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">pop</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_pop"</span><span class="p">),</span> <span class="s2">"gztar"</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="s2">"."</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">agent_file</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rel_file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">extra_files</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">archive_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dir</span>
</code></pre>
</div>
</details>
</div>
</div>
<h3 id="reading-inusing-a-saved-population">Reading in/using a Saved Population</h3>
<p>A population can be created from the files saved, however, there is no validation done to ensure the params used when running on this population make sense/match what was originally used when creating it.  Some things may validly change (e.g. interventions, reports needed, seeds), but others may result in strange behavior if changed (e.g. race distribution, what classes are in use).</p>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="titan.population_io.read">

<code class="highlight language-python"><span class="n">titan</span><span class="o">.</span><span class="n">population_io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


      </h4>
<div class="doc doc-contents first">
<p>Read a population from file and return a Population instance</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>params</code></td>
<td><code>ObjMap</code></td>
<td>
<p>the parameters used for creating this popultation</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>path</code></td>
<td><code>str</code></td>
<td>
<p>path where [id]_agents.csv and [id]_relationships.csv are or tar.gz file
containing population</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Population</code></td>
<td>
<p>the re-constituted population</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>titan/population_io.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">ObjMap</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Population</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Read a population from file and return a Population instance</span>

<span class="sd">    args:</span>
<span class="sd">        params: the parameters used for creating this popultation</span>
<span class="sd">        path: path where [id]_agents.csv and [id]_relationships.csv are or tar.gz file</span>
<span class="sd">            containing population</span>
<span class="sd">    returns:</span>
<span class="sd">        the re-constituted population</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">()</span>
        <span class="n">unpack_archive</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">dir</span>

    <span class="n">agent_file</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"*_agents.csv"</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rel_file</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"*_relationships.csv"</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">feat_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"*_feat_*.csv"</span><span class="p">))</span>
    <span class="n">exposure_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"*_exposure_*.csv"</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">agent_file</span><span class="p">),</span> <span class="sa">f</span><span class="s2">"can't find agents.csv in </span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rel_file</span><span class="p">),</span> <span class="sa">f</span><span class="s2">"can't find relationships.csv in </span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s2">"</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">agent_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">agent_file</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">agent_filename</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>

    <span class="c1"># create feature dict</span>
    <span class="n">agent_extras</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">update_agent_extras</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">extra_type</span><span class="p">):</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">f</span><span class="s2">"^.*_</span><span class="si">{</span><span class="n">extra_type</span><span class="si">}</span><span class="s2">_(.*)\.csv$"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">agent_extras</span><span class="p">[</span><span class="n">extra</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                        <span class="n">agent_extras</span><span class="p">[</span><span class="n">extra</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">"agent"</span><span class="p">])]</span> <span class="o">=</span> <span class="n">row</span>

    <span class="n">update_agent_extras</span><span class="p">(</span><span class="n">feat_files</span><span class="p">,</span> <span class="s2">"feat"</span><span class="p">)</span>
    <span class="n">update_agent_extras</span><span class="p">(</span><span class="n">exposure_files</span><span class="p">,</span> <span class="s2">"exposure"</span><span class="p">)</span>

    <span class="c1"># don't create any agents on init</span>
    <span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_pop</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

    <span class="c1"># re-create all agents and add to population</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">agent_file</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">create_agent</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span>
                <span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                <span class="n">pop</span><span class="o">.</span><span class="n">geography</span><span class="o">.</span><span class="n">locations</span><span class="p">,</span>
                <span class="n">agent_extras</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">pop</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># update num_pop to actual population</span>
    <span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_pop</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">()</span>

    <span class="c1"># re-create all relationships and add to population</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rel_file</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">create_relationship</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">pop</span><span class="p">)</span>
            <span class="n">pop</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pop</span>
</code></pre>
</div>
</details>
</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../partnering/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Partnering
              </div>
            </div>
          </a>
        
        
          <a href="../relationship/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Relationship
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['instant', 'tabs'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>